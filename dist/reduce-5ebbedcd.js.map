{"version":3,"file":"reduce-5ebbedcd.js","sources":["../src/internal/toTransducer.js","../src/internal/reducers.js","../src/reduce.js"],"sourcesContent":["import { is } from '#utils/is.js';\n\nexport function toTransducer(reducer, initial) {\n  if (is.function(reducer['@@transducer/step'])) {\n    return reducer;\n  }\n\n  return {\n    '@@transducer/init': function () {\n      if (initial !== undefined) return initial;\n      throw new Error('Method not implemented');\n    },\n    '@@transducer/result': function (state) {\n      return state;\n    },\n    '@@transducer/step': function (state, ...rest) {\n      return reducer(state, ...rest);\n    },\n  };\n}\n","function reduceArray(t, acc, m) {\n  const len = m.length;\n  let state = acc;\n\n  for (let i = 0; i < len; i++) {\n    state = t['@@transducer/step'](state, m[i], i, m);\n\n    if (state?.['@@transducer/reduced']) {\n      state = state['@@transducer/value'];\n      break;\n    }\n  }\n\n  return state;\n}\n\nfunction reduceMethod(t, acc, m) {\n  return m.reduce(t['@@transducer/step'], acc, m);\n}\n\nfunction reduceIterator(t, acc, it, m) {\n  let step = it.next();\n  let state = acc;\n  let idx = 0;\n\n  while (!step.done) {\n    state = t['@@transducer/step'](state, step.value, idx++, m);\n\n    if (state?.['@@transducer/reduced']) {\n      state = state['@@transducer/value'];\n      break;\n    }\n    step = it.next();\n  }\n\n  return state;\n}\n\nfunction reduceObj(t, acc, m) {\n  const keys = Object.keys(m);\n  const len = keys.length;\n  let state = acc;\n\n  for (let i = 0; i < len; i++) {\n    const k = keys[i];\n    const v = m[k];\n    state = t['@@transducer/step'](state, [k, v], m);\n\n    if (state?.['@@transducer/reduced']) {\n      state = state['@@transducer/value'];\n      break;\n    }\n  }\n\n  return state;\n}\n\nconst reduceIterable = (t, acc, m) => {\n  const it = m[Symbol.iterator].bind(m);\n  return reduceIterator(t, acc, it(), m);\n};\n\nexport const reducers = {\n  '[object Array]': reduceArray,\n  '[object Method]': reduceMethod,\n  '[object Iterator]': reduceIterable,\n  '[object Set]': reduceIterable,\n  '[object Map]': reduceIterable,\n  '[object Object]': reduceObj,\n  '[object String]': reduceArray,\n  '[object GeneratorFunction]': (t, acc, m) => reduceIterator(t, acc, m(), m),\n  '[object Generator]': (t, acc, m) => reduceIterator(t, acc, m, m),\n};\n","import { curry } from '#utils/curry.js';\nimport { get } from '#utils/internal/get.js';\nimport { reducers } from '#utils/internal/reducers.js';\nimport { toTransducer } from '#utils/internal/toTransducer.js';\n\n/**\n * Returns a single item by iterating through the collection, successively calling the iterator\n * function and passing it an accumulator value and the current value from the array, and\n * then passing the result to the next call.\n *\n * The iterator function receives: **(acc, value, index, collection)**. while reducing an object\n * it receives: **(acc, [value, key], collection)**.\n * It may use `reduced` to stop the iteration.\n *\n * It also accepts a transducer instead of an iterator function.\n *\n * Note: `reduce` does not skip deleted or unassigned indices (sparse arrays), unlike\n * the native `Array.prototype.reduce` method. For more details on this behavior, see:\n * [Array.prototype.reduce](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce#Description)\n * @see reduced\n *\n * @func\n * @category List\n * @param {Function} transducer The iterator function. Receives four values: the accumulator, the\n * current element from the Iterable, the iteration index and the whole Iterable. It also accepts a Transducer\n * @param {*} initial The accumulator initial value.\n * @param {Collection} collection An Iterable parameter.\n * @return {*} The final, accumulated value.\n * @example\n *\n * const add = (acc, act) => a + b;\n *\n * reduce(add, 'normal', 'string'); //=> 'normal string'\n * reduce(add, 10, [1, 2, 3]); //=> 16\n * reduce(add, 10, Set[1, 2, 3]); //=> 16\n * reduce(add, 10, function* () { yield* [1, 2, 3]}); //=> 16\n * reduce(add, '', { a: 1, b: 2 }); //=> 'a,1b,2'\n * reduce(add, '', Map{ a: 1, b: 2 }); //=> 'a,1b,2'\n *\n * @preserve true\n */\nexport const reduce = curry(function reduce(transducer, initial, collection) {\n  let _transducer = toTransducer(transducer);\n\n  const type = get.type(collection, 'reduce');\n\n  if (type in reducers) {\n    const result = reducers[type](_transducer, initial, collection);\n\n    return _transducer['@@transducer/result'](result);\n  }\n\n  throw new TypeError('reduce: collection type not supported: ' + type);\n});\n"],"names":["reduce"],"mappings":"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"}